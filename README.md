# ðŸš€id-server
ä¸€ä¸ªåŸºäºŽ**Spring Authorization Server**çš„å¼€æºçš„æŽˆæƒæœåŠ¡å™¨ï¼Œæ¬¢è¿ŽStarï¼Œå¦‚æžœæœ‰å…´è¶£ä¹Ÿå¯ä»¥å¯¹æœ¬é¡¹ç›®å‘èµ·è´¡çŒ®ã€‚
- gitee: [https://gitee.com/felord/id-server](https://gitee.com/felord/id-server)
- æ–‡æ¡£å»ºè®¾ä¸­â€¦â€¦
## ä¸»è¦åŠŸèƒ½
- åˆ›å»ºOAuth2å®¢æˆ·ç«¯ï¼Œå¹¶å¯¹OAuth2å®¢æˆ·ç«¯è¿›è¡Œç®¡ç†ã€‚
- UIæŽ§åˆ¶å°ï¼Œå¯åŠ¨æ€è°ƒæ•´ç®¡ç†å‘˜çš„ç”¨æˆ·è§’è‰²ã€‚
## ä¸»è¦æŠ€æœ¯
- Spring Boot
- Spring Security
- Spring Authorization Server
- Spring Data JPA
- H2 æ•°æ®åº“
- layui

## ç®€å•ç”¨æ³•
- æ‹‰å–ä¸»åˆ†æ”¯æœ€æ–°ä»£ç åˆ°æœ¬åœ°ã€‚
- é€šè¿‡`IdServerApplication`æ¥å¯åŠ¨æŽˆæƒæœåŠ¡å™¨ã€‚ç®¡ç†æŽ§åˆ¶å°æœ¬åœ°ç™»å½•è·¯å¾„ä¸º`http://localhost:9000/system/login`ï¼Œæœ€é«˜æƒé™ç”¨æˆ·ä¸º`root`ï¼Œå¯†ç ä¸º`idserver`ã€‚
- ä½ å¯ä»¥é€šè¿‡`root`ç”¨æˆ·åšè¿™äº›äº‹æƒ…ï¼š
  - åˆ›å»ºè§’è‰²ï¼ˆè§’è‰²ç®¡ç†ï¼‰å¹¶ä¸ºè§’è‰²ç»‘å®šæƒé™ã€‚
  - åˆ›å»ºæŽ§åˆ¶å°ç®¡ç†ç”¨æˆ·ï¼ˆç”¨æˆ·ç®¡ç†ï¼‰ï¼Œå¹¶èµ‹äºˆä»–ä»¬è§’è‰²ã€‚
> é€€å‡ºåŠŸèƒ½è¿˜æœªå®Œå–„ï¼Œéœ€è¦é€šè¿‡å…³é—­æµè§ˆå™¨æ¥æ¸…é™¤sessionã€‚
## oauth2 æµ‹è¯•æ–¹æ³•
- å¯åŠ¨**Id Server**ï¼Œé»˜è®¤æƒ…å†µä¸‹åœ¨å®¢æˆ·ç«¯åˆ—è¡¨æä¾›äº†ä¸€ä¸ªå†…ç½®çš„OAuth2å®¢æˆ·ç«¯ã€‚
- æ ·ä¾‹å®¢æˆ·ç«¯åœ¨`samples`æ–‡ä»¶å¤¹ä¸‹ï¼Œç›´æŽ¥å¯åŠ¨ï¼Œæµè§ˆå™¨é…ç½®æ–‡ä»¶ä¸‹çš„`http://127.0.0.1:8082/foo/bar`ï¼Œè¿›å…¥ç™»å½•é¡µï¼Œè¾“å…¥ç”¨æˆ·å`user`å’Œå¯†ç `user`å³å¯ã€‚
- ä½ ä¹Ÿå¯ä»¥åœ¨Id Serverä¸­åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯å¹¶æ¨¡ä»¿DEMOä¸­çš„é…ç½®ï¼Œä¸»è¦ä¿®æ”¹`client-id`,`client-secret`,`client-authentication-method`,`scope`ï¼Œå…¶å®ƒé€‰é¡¹é™¤éžä½ æ¯”è¾ƒäº†è§£OAuth2ï¼Œå¦åˆ™å…ˆä¸è¦åŠ¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡issueå’¨è¯¢ã€‚
> `redirect-uri`å¿…é¡»åœ¨æŽˆæƒæœåŠ¡å™¨Id Serveræ³¨å†Œå®¢æˆ·ç«¯æ—¶å£°æ˜Žã€‚
## çŽ¯å¢ƒ
ç›®å‰**Id Server**æä¾›**H2**å’Œ**Mysql**ä¸¤ç§æ•°æ®åº“çŽ¯å¢ƒï¼Œåˆ†åˆ«å¯¹åº”`application-h2.yml`å’Œ`application-mysql.yml`ä¸¤ä¸ªé…ç½®æ–‡ä»¶ã€‚
- **H2**ï¼Œé»˜è®¤æ•°æ®åº“ï¼Œåœ¨**H2**çŽ¯å¢ƒä¸‹ï¼Œæ•°æ®åº“DDLè„šæœ¬å’ŒDMLè„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€å¼€å‘è€…æ‰‹åŠ¨æ‰§è¡Œï¼Œè¯¥çŽ¯å¢ƒä¸»è¦ç”¨æ¥æµ‹è¯•ã€ç ”ç©¶ã€å­¦ä¹ ã€‚
- **Mysql**ï¼Œç”Ÿäº§æŽ¨èï¼Œ**é¦–æ¬¡å¯åŠ¨æ—¶å¼€å‘è€…æ‰‹åŠ¨æ‰§è¡Œåˆå§‹åŒ–DMLè„šæœ¬**ã€‚
> ç›®å‰ä¸¤ç§çŽ¯å¢ƒçš„æ•ˆæžœæ˜¯ä¸€è‡´çš„ï¼Œåˆ‡æ¢æ—¶åŠ¡å¿…åœ¨`pom.xml`ä¸­æ›´æ¢å¯¹åº”çš„æ•°æ®åº“é©±åŠ¨ç¨‹åºä¾èµ–ã€‚
## æ¦‚å¿µ
ä¸€äº›æ¦‚å¿µ
### OAuth2Client 

**å®¢æˆ·ç«¯**æŒ‡çš„æ˜¯**OAuth2 Client**ï¼Œä½†åˆä¸å•å•æ˜¯ä¸€ä¸ª**OAuth2 Client**ï¼Œè¿ž**id server**æœ¬èº«éƒ½æ˜¯ä¸€ä¸ª**å®¢æˆ·ç«¯**ã€‚

### `role`å’Œ`scope`çš„å…³ç³»

`role`å’Œ`scope`å…¶å®žæ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œåªä¸è¿‡é¢å‘çš„å¯¹è±¡ä¸ä¸€æ ·ã€‚`role`é’ˆå¯¹çš„æ˜¯èµ„æºæ‹¥æœ‰è€…ï¼ˆResource Ownerï¼‰ï¼Œè€Œ`scope`é’ˆå¯¹çš„æ˜¯**OAuth2å®¢æˆ·ç«¯**ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ`ROLE_email`æ˜¯ç”¨æˆ·å…·æœ‰èŽ·å–ç”µå­é‚®ä»¶ä¿¡æ¯çš„æŽ¥å£è®¿é—®æƒé™ï¼Œ`SCOPE_email`æ˜¯æ‹¥æœ‰`ROLE_email`æƒé™çš„ç”¨æˆ·æŽˆæƒOAuth2å®¢æˆ·ç«¯è®¿é—®èŽ·å–ç”µå­é‚®ä»¶ä¿¡æ¯æŽ¥å£ï¼Œç”¨æˆ·å¦‚æžœæ²¡æœ‰è¿™ä¸ªæƒé™ï¼Œé‚£ä»–å‡­ä»€ä¹ˆæŽˆæƒå‘¢ï¼Ÿ
> æ‰€ä»¥ç»“è®ºå°±æ˜¯ï¼š `ROLE_email`=`SCOPE_email`=`email`ã€‚

